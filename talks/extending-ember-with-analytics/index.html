<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Extending Ember with Analytics | Alex DiLiberto</title>

    <meta name="description" content='EmberConf 2014 talk by Alex Diliberto explaining how to integrate web analytics tools into your Ember project.'>
    <meta name="author" content="Alex DiLiberto">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">

    <!-- Alex's Global CSS -->
    <style>
      blockquote > footer { text-align: right }
      .bg-white { background-color: white !important; }
      .cf:before, .cf:after { content: " "; display: table; }
      .cf:after { clear: both; }
      .emphasis { color: #e7ad52; }
      ul ul { font-size: .8em !important; }
      .references { font-size: .6em !important; }
    </style>

    <!-- Presentation Specific CSS -->
    <style>
      .reveal section img { border: none; background-color: transparent; box-shadow: none; }
    </style>

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
      }
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section class="slide-intro">
          <h1>Extending Ember with Analytics</h1>
          <p>Alex DiLiberto</p>
          <p><a href="http://twitter.com/alex_diliberto">@alex_diliberto</a></p>
          <p><a href="http://alexdiliberto.com">alexdiliberto.com</a></p>
        </section>

        <section class="slide-1">
          <h2>Web Analytics?</h2>

          <aside class="notes">
            <p>Basically the measurement &amp; reporting of website visitor data to help understand and optimize website usage.</p>
            <ul>
              <li>how many people visited your website</li>
              <li>where they were from</li>
              <li>which pages they visited</li>
              <li>how long they stayed on those pages</li>
              <li>if they are a returning visitor</li>
              <li>which search keywords they used to get them to your website</li>
              <li>user brower information</li>
            </ul>
            <small>Even higher level things like - Do they like your recent changes and updates? How effective are your marketing campaigns?</small>
            <p>Summary: Web analytics give you the power to know how your visitors use your website. It allows you to identify trends and make adjustments based on real data.</p>
            <p>Theres so many different web analytics tools out there - focus on Google Analytics (personal) and Adobe SiteCatalyst (work).</p>
          </aside>
        </section>

        <section class="slide-2">
          <img src="img/ember-logo.png" alt="Ember logo" width="596" height="227" class="ember-logo">
          <img src="img/google-analytics-logo.png" alt="Google Analytics logo" width="384" height="384" class="google-analytics-logo">
          <aside class="notes">
            <p>Integration: Easy right? Sign up online with you favorite analytics software, copy/paste the tracking javascript with your unique identifier and you're all set.</p>
            <p>SPWebApps, that easy integration becomes far less trivial.</p>
            <p>The whole application lives on a one HTML page so all Analytics would report back to you is how many people loaded your application.</p>
            <small>No visibility into what they are doing after that.</small>
            <p>Lets Fix This! Just have to recreate some of the things we get for free with classic fullpage reloads.</p>
          </aside>
        </section>

        <section class="slide-3">
          <h2>Things to track:</h2>

          <ol>
            <li class="fragment" data-fragment-index="1">Page Views
              <ul>
                <li class="fragment" data-fragment-index="1"><code>{{link-to}}</code></li>
                <li class="fragment" data-fragment-index="1"><code>this.transitionTo()</code></li>
                <li class="fragment" data-fragment-index="1"><code>/post/1</code>&#8594;<code>/post/2</code></li>
                <li class="fragment" data-fragment-index="1">URL</li>
              </ul>
            </li>
            <li class="fragment" data-fragment-index="2">Actions
              <ul>
                <li class="fragment" data-fragment-index="2"><code>{{action}}</code></li>
                <li class="fragment" data-fragment-index="2"><code>this.send()</code></li>
                <li class="fragment" data-fragment-index="2">Simple actions</li>
              </ul>
            </li>
          </ol>

          <aside class="notes">
            <p>Page view tracking basically just translates to route changes.</p>
            <p>Simple actions: User actions that you want to track which don't really need to fire any sort of event.</p>
            <small>
              <ul>
                <li>Typing in a username then pressing tab</li>
                <li>Tracking a successful login</li>
                <li>Tracking a user timeout warning</li>
              </ul>
            </small>




            <!-- TODO: UPDATE -->
            <p>Shoutout to Matthew Beale who did some great work on integrating the didTransition hook into the router - which really helps to make this implementation so much cleaner.</p>
            <p>Didn't like the idea of including some mixing for every route because this is an application wide requirement.</p>
            <p>Also didn't like the idea of mucking up our templates by adding analytics specifc {{actions}} all over the place</p>
            <p>Talk about na√Øve approaches and better solutions</p>
            <p>Full demo time</p>




          </aside>
        </section>

        <section class="slide-4">
          <h2>Naive approach</h2>
          <pre>
            <code class="javascript">
  Ember.Analytics = Ember.Mixin.create({
    trackPageView: function() {
      Ember.run.next(function() {
        var loc = window.location,
            page = loc.hash ? loc.hash.substring(1) : loc.pathname + loc.search;
        ga('send', 'pageview', page);
      });
    }.observes('currentPath')
  });
            </code>
          </pre>

          <a href="http://emberjs.jsbin.com/puzax/12/edit">http://emberjs.jsbin.com/puzax/12/edit</a>

          <aside class="notes">
            <p>Page View Tracking</p>
            <p>A beginning naive approach would be to create a Mixin/currentPath observer.</p>
            <ul>
              <li>If you want this on the application controller and it was being generated for you then you must still instantiate an empty controller using the mixin.</li>
              <li>Even worse, inject this Mixin onto each controller you want to track. (UGHHH!)</li>
              <li>Doesn't scale well particularly well</li>
              <li>Manually grabbing the URL via window.location (not Ember friendly!)</li>
              <li>Don't have access to the internal router object within the scope of this Mixin</li>
              <li>Does NOT work for dynamic routes with model changes only (e.g posts/1 -> posts/2)</li>
              <li>Does NOT work for loading state or error state</li>
            </ul>
            <b>Not a good solution!</b>
          </aside>
        </section>

        <section class="slide-5">
          <h2>Winning approach</h2>
          <pre>
            <code>
  App.ApplicationRoute = Ember.Route.extend({
    actions: {
      didTransition: function() {
        Ember.run.once(this, function() {
          ga('send', 'pageview', router.get('url'));
        });
      }
    }
  });
            </code>
          </pre>

          <a href="http://emberjs.jsbin.com/puzax/14/edit">http://emberjs.jsbin.com/puzax/14/edit</a>

          <aside class="notes">
            <p>Page View Tracking</p>
            <p>A winning solution would be to add a `didTransition` hook to the Application Route.</p>
            <ul>
              <li>Clean</li>
              <li>Can simply rely on generate application controller if needed.</li>
              <li>Scales well (if for some weird reason you had routes that you didn't need to track, you could just create a lookup table)</li>
              <li>Grabbing the URL via the internal router object (Ember friendly now!)</li>
              <li>Works perfectly for both route changes, dynamic model changes, loading state, and error state</li>
            </ul>
            <p>Aghhh, much better!</p>
          </aside>
        </section>

        <section class="slide-6">
          <h2>Naive approach</h2>
          <pre>
            <code class="xml">
  <script type="text/x-handlebars" data-template-name="about/him">
    <h2>about/him</h2>
    <button {{action 'track' 'like him'}}>Like Him</button>
  </script>
  <script type="text/x-handlebars" data-template-name="about/her">
    <h2>about/her</h2>
    <button {{action 'track' 'like her'}}>Like Her</button>
  </script>
            </code>
            <code class="javascript">
  App.ApplicationRoute = Ember.Route.extend({
    actions: {
      track: function(data) {
        ga('send', 'event', event.target.nodeName, event.type,
           event.target.className, data);
      }
    }
  });
            </code>
          </pre>

          <a href="http://emberjs.jsbin.com/puzax/18/edit">http://emberjs.jsbin.com/puzax/18/edit</a>

          <aside class="notes">
            <p>Event Tracking</p>
            <p>A naive solution would be to add {{action}} handlers on the specific elements within each template then bubble up to ApplicationRoute and track.</p>
            <ul>
              <li>Litters templates with analytics-specific actions</li>
              <li>No encapsulation so the code begins to fragment extrememly quickly</li>
              <li>Doesn't scale well for a larger applications</li>
            </ul>
            <p>Not good!</p>
          </aside>
        </section>

        <section class="slide-7">
          <h2>Winning approach</h2>
          <pre>
            <code class="xml">

            </code>
          </pre>

          <a href="http://emberjs.jsbin.com/puzax/19/edit">http://emberjs.jsbin.com/puzax/19/edit</a>

          <aside class="notes">
Notes on the ActionHandler approach:
- Bubbling actions (returning true from an action handler) only trigger capturing once, at the top-most level.
- Catches programmatic action sending and exposes it to logging as well.
- Allows for a fully declarative analytics pattern.
          </aside>
        </section>

        <section class="slide-8">
          <img src="img/tomster-under-construction.png" alt="Tomster mascot with a hardhat" width="472" height="529" class="ember-hardhat">
        </section>

        <section class="slide-13">
          <h2>References</h2>
          <div class="references">
            <p><a href="http://www.agilestyle.com/blog/what-are-web-analytics-and-why-should-i-care">What are Web Analytics and Why Should I Care? | agilestyle.com</a></p>
            <p><a href="https://github.com/emberjs/ember.js/pull/3453">emberjs/ember.js issue #3453</a></p>
          </div>
        </section>

        <section class="slide-14">
          <h2>Thanks!</h2>
          <p>Alex DiLiberto</p>
          <p><a href="http://twitter.com/alex_diliberto">@alex_diliberto</a></p>
          <p><a href="http://alexdiliberto.com">alexdiliberto.com</a></p>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        rollingLinks: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>
  </body>
</html>
